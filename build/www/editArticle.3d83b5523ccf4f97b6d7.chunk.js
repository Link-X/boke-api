(window.webpackJsonp=window.webpackJsonp||[]).push([["editArticle"],{"2dgN":function(e,t,r){"use strict";var n=r("TqRt");r("pNMO"),r("TeQF"),r("QWBl"),r("5DmW"),r("27RR"),r("tkto"),r("FZtP"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r("lSNA")),i=n(r("lwsE")),o=n(r("W8MJ")),u=r("Dsns");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var s=function(){function e(t,r){(0,i.default)(this,e),this.data=null,this.rules={},this.$init(t,r)}return(0,o.default)(e,[{key:"$init",value:function(e,t){this.data=JSON.parse(JSON.stringify(e)),this.rules=t}},{key:"ruleCallBack",value:function(e){return function(t){e.status=!(!t||!t.message),e.message=t&&t.message}}},{key:"verifyTop",value:function(e,t){var r=(e.type?e.type:(0,u.getType)(t)).toLocaleLowerCase(),n=u.typeOfS[r]||function(){};return!(t&&n(t))}},{key:"verifyBottom",value:function(e,t){if(!(e.min&&e.max&&"date"!==e.type))return!1;var r=(0,u.getType)(t),n=u.getTypeLen[r](t);return!(n>=e.min&&n<=e.max)}},{key:"iterator",value:function(e){if((0,u.isObject)(e)){for(var t={status:!1,message:"",key:""},r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=c(c({},this.rules[a][0]),this.rules[a][1]),o=this.data[a];if((0,u.isFunc)(i.validator)?i.validator(o,this.ruleCallBack(t)):i.required?t.status=this.verifyTop(i,o)||this.verifyBottom(i,o):!i.required&&i.min&&i.max&&(t.status=o&&this.verifyBottom(i,o)),t.status)return t.key=a,t.message=t.message?t.message:i.message,t}return t}}},{key:"validate",value:function(e){var t=this.iterator(this.rules),r={key:t.key,result:t.status||t.message,message:t.message};return e(r),r}},{key:"addRule",value:function(e){}}]),e}();t.default=s},"6epX":function(e,t,r){"use strict";var n=r("TqRt");r("07d7"),r("5s+n"),Object.defineProperty(t,"__esModule",{value:!0}),t.VisitorFormVerify=void 0;var a=new(n(r("2dgN")).default)({},{});t.VisitorFormVerify=function(e){return new Promise((function(t,r){console.log(e),a.$init(e,{title:[{required:!0,message:"请输入3-50字文章标题",type:"string",min:3,max:50}],markdown:[{required:!0,message:"内容请最少输入60字",type:"string",min:60,max:99999999}],tagId:[{message:"请选择文章标签",validator:function(e,t){console.log(e),e||0===e?t():t(new Error("请选择文章标签"))}}]}),a.validate((function(e){if(e.result)return r(e);t(e)}))}))}},"944O":function(e,t,r){"use strict";var n=r("TqRt");r("2B1R"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r("q1tI")),i=r("bmkC"),o=function(e){var t=e.form,r=e.tagData,n=e.uploadInput;return a.default.createElement("div",{className:"edit-header"},a.default.createElement("input",{type:"file",onChange:e.uploadImg,accept:"image/*",className:"uploadInput",ref:n}),a.default.createElement("div",{className:"edit-article_title"},a.default.createElement("div",{className:"edit-article_inp"},a.default.createElement("input",{defaultValue:t.title,onChange:function(t){e.setInp(t.target.value)},placeholder:"请输入文章标题..."})),a.default.createElement("div",{className:"edit-article-btn"},a.default.createElement("div",{style:{marginRight:"10px",display:"flex",alignItems:"center"}},a.default.createElement(i.Popover,{placement:"bottom",title:"上传封面",content:a.default.createElement("div",{className:"upload-content"},t.articleImg?a.default.createElement("div",{className:"edit-article_img_box"},a.default.createElement("span",{onClick:e.removeImg},"x"),a.default.createElement("img",{src:t.articleImg,style:{width:"100%",height:"100%"}})):a.default.createElement("p",{onClick:e.clickFile},"点击添加封面")),trigger:"click"},a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:"35px",height:"35px",viewBox:"0 0 28 28",version:"1.1"},a.default.createElement("title",null,"699ED11E-7F16-40A5-89DD-C9ADE30CCB4C"),a.default.createElement("desc",null,"Created with sketchtool."),a.default.createElement("defs",null),a.default.createElement("g",{id:"0.1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},a.default.createElement("g",{id:"Markdown－编辑3",transform:"translate(-1247.000000, -18.000000)",fill:"#BFC6CE"},a.default.createElement("g",{id:"heder_img",transform:"translate(1247.000000, 18.000000)"},a.default.createElement("path",{d:"M5,7 L24,7 L24,21 L5,21 L5,7 Z M6,8 L23,8 L23,15 L6,15 L6,8 Z M9,11 C9.55228475,11 10,10.5522847 10,10 C10,9.44771525 9.55228475,9 9,9 C8.44771525,9 8,9.44771525 8,10 C8,10.5522847 8.44771525,11 9,11 Z M22,14 L10,14 L14.2570991,10.8078101 L15.778026,11.8338712 L19.2346782,8.98370162 L22,11.0150952 L22,14 Z"}))))))),a.default.createElement("div",{className:"article-btn_subimt"},a.default.createElement(i.Popover,{className:"article-box",placement:"bottom",title:"发布文章",content:a.default.createElement("div",{className:"article-submit_box"},a.default.createElement("ul",{className:"submit-box_tag"},a.default.createElement("span",null,"分类"),r.map((function(t){return a.default.createElement("li",{key:t.id,onClick:function(){e.selectTag(t)},className:t.checkouted?"article":""},t.tag)}))),a.default.createElement("div",{className:"submit-submit"},a.default.createElement(i.Button,{type:"primary",onClick:e.submit},"确定发布"))),trigger:"click"},"发布")),a.default.createElement("div",{className:"article-btn_user"},a.default.createElement("img",{src:"https://mirror-gold-cdn.xitu.io/168e08e1a5a2e53f643?imageView2/1/w/64/h/64/q/85/interlace/1"})))))};t.default=o},Cx7q:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markdownText=void 0;t.markdownText='\n#  H1\n##  H2\n###  H3\n####  H4\n#####  H5\n######  H6\n\n*斜体* or _强调_  \n**加粗** or __加粗__  \n***粗斜体*** or ___粗斜体__  \n\nUnordered 无序列表：\n* 无序列表\n* 子项\n* 子项\n \n+ 无序列表\n+ 子项\n+ 子项\n \n- 无序列表\n- 子项\n- 子项\n\nOrdered 有序列表：\n* 产品介绍（子项无项目符号）\n    此时子项，要以一个制表符或者4个空格缩进\n \n* 产品特点\n    1. 特点1\n    - 特点2\n    - 特点3\n* 产品功能\n    1. 功能1\n    - 功能2\n    - 功能3\n    \n[链接](http://www.w3cschool.cn/ "W3Cschool")\n![图片代替文字](http://39.108.184.64/image/111837354148716541576488564080.jpg "标题文字")\n\n段落\n> Email-style angle brackets\n> are used for blockquotes.\n> > And, they can be nested.\n> #### Headers in blockquotes\n> * You can quote a list.\n> * Etc.\n\n表格  \n\n|姓名|性别|年龄|\n|:---:|:---:|:---:|:---:|\n| 许道斌 | 男 | 18岁 |\n'},Dsns:function(e,t,r){"use strict";r("sMBO"),r("tkto"),r("07d7"),r("JfAA"),Object.defineProperty(t,"__esModule",{value:!0}),t.getTypeLen=t.typeOfS=t.getType=t.getNumLen=t.getObjLen=t.getLen=t.verifyDate=t.isDate=t.objectLen=t.arrayLen=t.isNull=t.isObject=t.isFunc=t.isBoolean=t.isString=t.isNumber=t.isArray=void 0;var n=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.isArray=n;var a=function(e){return"[object Number]"===Object.prototype.toString.call(e)};t.isNumber=a;var i=function(e){return"[object String]"===Object.prototype.toString.call(e)};t.isString=i;var o=function(e){return"[object Boolean]"===Object.prototype.toString.call(e)};t.isBoolean=o;t.isFunc=function(e){return"[object Function]"===Object.prototype.toString.call(e)};var u=function(e){return"[object Object]"===Object.prototype.toString.call(e)};t.isObject=u;t.isNull=function(e){return"[object Null]"===Object.prototype.toString.call(e)};t.arrayLen=function(e){return n(e)?e.length:null};t.objectLen=function(e){return u(e)?Object.keys(e).length:null};var l=function(e){return!!e&&"Invalid Date"!==new Date(e).toString()};t.isDate=l;var c=function(e){return n(e)?l(e[0])&&l(e[1]):l(e)};t.verifyDate=c;var s=function(e){return e?e.length:null};t.getLen=s;var f=function(e){return Object.keys(e).length};t.getObjLen=f;var d=function(e){return e};t.getNumLen=d;t.getType=function(e){return e&&e.constructor.name.toLowerCase()||"string"};var p={array:n,object:u,number:a,string:i,boolean:o,date:c};t.typeOfS=p;var m={array:s,object:f,number:d,string:s,date:s};t.getTypeLen=m},ZqyS:function(e,t,r){"use strict";var n=r("TqRt");r("07d7"),r("SuFq"),r("rB9j"),r("JfAA"),r("Rm1S"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r("lwsE")),i=n(r("W8MJ")),o=n(r("PJYZ")),u=n(r("7W2i")),l=n(r("a1gu")),c=n(r("Nsbk")),s=n(r("lSNA")),f=n(r("q1tI"));r("p77/"),r("7Zzg");var d=n(r("VrN/"));function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}r("C2zF"),r("uTOq"),r("GP5n"),r("9rZZ"),r("m3Q/"),r("+dQi"),r("PJhV"),r("/9rB"),r("mRzX"),r("ewDg"),r("ERtv"),r("dLt8"),r("kvE4"),r("1p+/"),r("J2ja"),r("1eCo"),r("jDMi"),r("HvfG"),r("ELLl"),r("lZu9"),r("mki7"),r("Ku0u"),r("cokd"),r("5a5h"),r("RJim"),r("H9tZ"),r("aT2M"),r("McUL"),r("8EBN"),r("scEK"),r("S6bl");var m="undefined"==typeof navigator||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i),v=function(e){(0,u.default)(r,e);var t=p(r);function r(e){var n;return(0,a.default)(this,r),n=t.call(this,e),(0,s.default)((0,o.default)(n),"editor",void 0),n.state={isControlled:Boolean(n.props.value)},n.handleChange=n.handleChange.bind((0,o.default)(n)),n.editorRef=f.default.createRef(),n}return(0,i.default)(r,[{key:"componentDidMount",value:function(){this.props.forceTextArea||m||(this.editor=d.default.fromTextArea(this.editorRef.current,{keyMap:"sublime",mode:"markdown",theme:"seti",gitHubSpice:!0,taskLists:!0,strikethrough:!0,emoji:!1,lineWrapping:!0,value:this.props.value,autoRefresh:!0,json:!0,indentUnit:4,tabSize:4,coder:null,extraKeys:{Ctrl:"autocomplete"},onChange:this.props.onChange}),this.editor.on("change",this.handleChange),this.editor.on("scroll",this.props.editOnScroll))}},{key:"componentDidUpdate",value:function(){this.editor&&this.props.value&&this.editor.getValue()!==this.props.value&&this.editor.setValue(this.props.value)}},{key:"setCursor",value:function(){this.editor.doc.setCursor(this.editor.doc.lineCount()-1,0)}},{key:"handleChange",value:function(){if(this.editor){var e=this.editor.getValue();e!==this.props.value&&(this.props.onChange&&this.props.onChange({target:{value:e}}),this.editor.getValue()!==this.props.value&&(this.state.isControlled?this.editor.setValue(this.props.value):this.props.value=e))}}},{key:"render",value:function(){var e=f.default.createElement("textarea",{ref:this.editorRef,readOnly:this.props.readOnly,defaultValue:this.props.value,onChange:this.props.onChange,className:this.props.textAreaClassName});return f.default.createElement("div",null,e)}}]),r}(f.default.Component);t.default=v},"jkY+":function(e,t,r){"use strict";var n=r("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r("q1tI")),i=r("bmkC"),o=function(e){var t=e.preview;return a.default.createElement("ul",{className:"textare-tools"},a.default.createElement("input",{type:"file",onChange:e.centerUploadImg,accept:"image/*",className:"centeruploadInput",ref:e.centerInput}),a.default.createElement("li",{onClick:function(t){e.clickFile()}},a.default.createElement(i.Tooltip,{title:"上传图片"},a.default.createElement("i",{className:"iconfont icon-shangchuan"}))),a.default.createElement("li",{onClick:e.activedPreview},a.default.createElement(i.Tooltip,{title:"".concat(t?"预览(不要刷新）":"收起(刷新会丢失)")},a.default.createElement("i",{className:"iconfont ".concat(t?"icon-suofang":"icon-BMSzhuanqu_suofang")}))))};t.default=o},pnOm:function(e,t,r){"use strict";var n=r("284h"),a=r("TqRt");r("pNMO"),r("TeQF"),r("QWBl"),r("2B1R"),r("5DmW"),r("27RR"),r("tkto"),r("FZtP"),r("R5XZ"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r("o0o1"));r("ls82");var o=a(r("yXPU")),u=a(r("lSNA")),l=a(r("J4zp")),c=n(r("q1tI")),s=a(r("IujW")),f=r("bmkC"),d=a(r("ZqyS")),p=a(r("6pIu")),m=a(r("jkY+")),v=a(r("944O")),g=r("eZYV"),h=r("Cx7q"),y=r("6epX"),b=r("0lfv"),k=r("Xube");function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r("5MvH"),r("exD2");var E=function(e){var t=(0,g.useSetState)({form:{markdown:h.markdownText,tagId:void 0,title:"",articleImg:"",id:void 0},tagData:[],preview:!0}),r=(0,l.default)(t,2),n=r[0],a=r[1],u=(0,c.useRef)(),w=(0,c.useRef)(),E=(0,c.useRef)(),j=(0,c.useRef)(),C=(0,c.useRef)(),x=function(){a({form:O({},L)})},N=function(){var e=(0,o.default)(i.default.mark((function e(t){var r,n,a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.compressionImg)(t);case 2:return r=e.sent,e.next=5,(0,k.uploadImage)({file:r});case 5:return n=e.sent,a=n.path,w.current.value="",E.current.value="",e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=(0,o.default)(i.default.mark((function e(t){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.form,e.next=3,N(t);case 3:r.articleImg=e.sent,x();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=(0,o.default)(i.default.mark((function e(t){var r,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t);case 2:r=e.sent,(o=n.form).markdown+="  ![](".concat(r,")"),a({form:O({},o)}),setTimeout((function(){u.current.setCursor()}),20);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var t=(0,o.default)(i.default.mark((function t(){var r,a;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.form,a=r.id?k.editArticleDetials:k.addArticle,t.prev=2,t.next=5,a(r);case 5:f.message.success("保存成功"),e.history.push("/article"),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),f.message.error("保存失败");case 12:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(){return t.apply(this,arguments)}}(),_=function(){var e=(0,o.default)(i.default.mark((function e(t){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),e.prev=1,r=n.form,e.next=5,(0,y.VisitorFormVerify)(r);case 5:S(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),f.message.error(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=(0,o.default)(i.default.mark((function e(t){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,k.getTags)(null);case 2:r=e.sent,a({tagData:r.map((function(e){return e.checkouted=e.id===t,e}))});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=(0,o.default)(i.default.mark((function e(t){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return I(null),e.abrupt("return");case 3:return e.next=5,(0,k.getArticleDetails)(t);case 5:return r=e.sent,e.next=8,I(r.tagId);case 8:a({form:{markdown:r.markdown,tagId:r.tagId,title:r.title,articleImg:r.articleImg,id:+t}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=n.form,T=n.tagData,A=n.preview;return(0,c.useEffect)((function(){var e;e=(0,b.getUrlParam)().id,R(e)}),[]),c.default.createElement("div",{className:"edit-article_box"},c.default.createElement(v.default,{form:L,tagData:T,setInp:function(e){n.form.title=e,x()},uploadImg:P,clickFile:function(){w.current.click()},removeImg:function(){n.form.articleImg="",w.current.value="",x()},uploadInput:w,selectTag:function(e){var t=n.tagData,r=n.form;t=t.map((function(t){return t.checkouted=t.id===e.id,O({},t)})),r.tagId=e.id,a({tagData:t,form:O({},r)})},submit:_}),c.default.createElement("div",{className:"edit-article-edit"},c.default.createElement("div",{ref:j,className:"edit-article-textare editor-pane",style:{display:"".concat(A?"block":"none")}},c.default.createElement(d.default,{ref:u,editOnScroll:function(e){var t=e.doc,r=t.scrollTop,n=t.height,a=j.current.getBoundingClientRect().height,i=(n-a)/(document.querySelector(".markdown-body").getBoundingClientRect().height-a);C.current.scrollTo(0,r/i)},value:L.markdown,onChange:function(e){n.form.markdown=e.target.value,x()}})),c.default.createElement("div",{ref:C,className:"edit-article-markdown result-pane ".concat(A?"engter-edit":"preview-edit")},c.default.createElement(s.default,{className:"markdown-body",skipHtml:!0,renderers:{code:p.default},source:L.markdown}),c.default.createElement(m.default,{centerInput:E,centerUploadImg:D,preview:A,clickFile:function(){E.current.click()},activedPreview:function(e){a({preview:!A})}}))))};t.default=E}}]);